{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-4">

  <h2>「{{ query }}」の検索結果</h2>

  {# タグ #}
  {% if results.tags %}
    <p class="mt-3">一致したタグ:
      {% for tag in results.tags %}
        <span class="badge bg-secondary">#{{ tag.name }}</span>
      {% endfor %}
    </p>
  {% endif %}

  {# ユーザー #}
  {% if results.users %}
  <div class="row g-4 my-4">
    {% for user in results.users %}
    <div class="col-6 col-sm-4 col-md-3 col-lg-2 text-center">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column align-items-center">
          {# ユーザープロフィールリンク #}
          <a href="{{ user.get_absolute_url }}">
            {% if user.avatar %}
              <img src="{{ user.avatar.url }}" alt="アバター画像" class="rounded-circle mb-2" style="width: 64px; height: 64px; object-fit: cover;">
            {% else %}
              <img src="{% static 'images/default_avatar.png' %}" alt="デフォルトアバター" class="rounded-circle mb-2" style="width: 64px; height: 64px; object-fit: cover;">
            {% endif %}
          </a>
          <div class="fw-semibold text-dark mb-1">{{ user.username }}</div>
          <div class="text-muted small mb-2">
            フォロワー: {{ user.followers.count }}
          </div>
          <div class="mt-auto">
            {% if user.tags.all %}
              {% for ut in user.tags.all|slice:":3" %}
                <span class="badge bg-primary">#{{ ut.tag.name }}</span>
              {% endfor %}
            {% else %}
              <span class="text-muted">タグなし</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {# ブログ記事 #}
  <h4>ブログ記事</h4>
  {% if results.blog_posts %}
    <ul class="list-group mb-3">
      {% for post in results.blog_posts %}
        <li class="list-group-item">
          <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
          <br>
          <small>by {{ post.author.username }} | 
            {% for t in post.tags.all %}
              <span class="badge bg-light text-dark">#{{ t.name }}</span>
            {% endfor %}
          </small>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>該当するブログ記事はありません。</p>
  {% endif %}

</div>
{% endblock %}
